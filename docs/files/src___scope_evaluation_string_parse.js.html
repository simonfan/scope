<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/__scope/evaluation/string/parse.js - scope</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="scope"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/scope.html">scope</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/__scope/evaluation/string/parse.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define(function (require, exports, module) {
	&#x27;use strict&#x27;;

	var _ = require(&#x27;lodash&#x27;);

	/**
	 * \s*      -&gt; any (*) number of whitespace characters
	 * (?:      -&gt; start non-capturing group of options
	 *  (        -&gt; start KEY&amp;VALUE-REFERENCE capturing group
	 *   [^:]+?   -&gt; match anything but colon ([^:]) at least once (+) non-greedy (?)
	 *  )        -&gt; close KEY&amp;VALUE-REFERENCE capturing group
	 *  |        -&gt; or
	 *  (?:      -&gt; start KEY-ONLY &amp; VALUE-REFERENCE-ONLY non-capturing group
	 *   (        -&gt; start KEY-ONLY capturing group
	 *    [^:]+?   -&gt; match anything but colon ([^:]) at least once (+) non-greedy (?)
	 *   )        -&gt; close KEY-ONLY capturing group
	 *   :        -&gt; match the colon (KEY:VALUE separator)
	 *   (        -&gt; start VALUE-REFERENCE capturing group
	 *    .+?      -&gt; match anything (.) at least once (+) non-greedy (?)
	 *   )        -&gt; close VALUE-REFERENCE capturing group
	 *  )        -&gt; close KEY-ONLY &amp; VALUE-REFERENCE-ONLY non-capturing group
	 * )        -&gt; close non-capturing group of options
	 * \s*      -&gt; match any number (*) of whitespace characters (\s)
	 * (?:,|$)  -&gt; until the comma or end of string
	 */

	// sample object string: &quot;$arg3, key: $arg4, key1: literalValue&quot;

	/**
	 *
	 * (\$\w+) -&gt; KEY&amp;EVALUATED 		[1]
	 *
	 * (?:
	 *  (\w+) -&gt; LITERAL KEY 		[2]
	 *  :\s*
	 *  (?:
	 *   (\w+)  -&gt; LITERAL VALUE 	[3]
	 *   |
	 *   (\$\w+) -&gt; EVALUATED VALUE 	[4]
	 *  )
	 * )
	 */
	var keyMatcher = /(?:\$(\w+)|(?:(\w+):\s*(?:(\w+)|\$(\w+))))\s*(?:,|$)/g;

/*
	/(?:
		(\$\w+)
		|
		(?:
			(\w+):\s*
			(?:
				(\$\w+)
				|
				(\w+)
			)
		)
	)
	\s*
	(?:,|$)/g;
*/

	function parseObjectStr(str) {

		var res = {},
			keyMatch;

		while (keyMatch = keyMatcher.exec(str)) {

			// [0] full matched string
			// [1] captured KEY&amp;EVALUATED
			// [2] captured LITERAL KEY
			// [3] captured EVALUATED VALUE
			// [4] captured LITERAL VALUE

			if (keyMatch[1]) {
				// key &amp; evaluated value

				res[keyMatch[1]] = {
					type: &#x27;evaluated&#x27;,
					value: keyMatch[1]
				};

			} else if (keyMatch[2]) {
				// literal alias key

				if (keyMatch[3]) {
					// literal value
					res[keyMatch[2]] = {
						type: &#x27;literal&#x27;,
						value: keyMatch[3]
					};

				} else if (keyMatch[4]) {
					// evaluated value
					res[keyMatch[2]] = {
						type: &#x27;evaluated&#x27;,
						value: keyMatch[4]
					};
				}

			}

		}

		return res;

	}


	/**
	 * \s*            -&gt; any number of whitespaces
	 *  (?:            -&gt; start non-capturing OR group
	 *   ($\w+)         -&gt; capture EVALUATED
	 *  |              -&gt; OR
	 *   (\w+)          -&gt; capture LITERAL
	 *  |              -&gt;OR
	 *   \{             -&gt; match &quot;{&quot; followed by any number of whitespace characters
	 *   \s*            -&gt;
	 *   (.*?)          -&gt; capture OBJECT
	 *   \s*\}          -&gt; match &quot;}&quot; preceded by any number of whitespace characters
	 *  )              -&gt; close non-capturing OR group
	 *  \s*            -&gt; followed by any number of whitespace characters
	 *  (?:,|$)        -&gt; until a comma or the end of the string.
	 */

	// sample arguments string: &quot;literal, $evaluated, {$arg3, key: $arg4}&quot;
	var argMatcher = /\s*(?:(\w+)|\$(\w+)|\{\s*(.*?)\s*\})\s*(?:,|$)/g;
	module.exports = function parseArgumentsStr(str) {
		// results
		var res = [],
			argMatch;

		while (argMatch = argMatcher.exec(str)) {

			// [0] the matched string
			// [1] captured LITERAL arg
			// [2] captured EVALUATED arg
			// [3] captured OBJECT arg

			if (argMatch[1]) {
				// LITERAL
		//		console.log(&#x27;LITERAL: &#x27; + argMatch[1]);

				res.push({
					type: &#x27;literal&#x27;,
					value: argMatch[1]
				});

			} else if (argMatch[2]) {
				// EVALUATED
		//		console.log(&#x27;EVALUATED: &#x27; + argMatch[2]);
				res.push({
					type: &#x27;evaluated&#x27;,
					value: argMatch[2]
				});


			} if (argMatch[3]) {
				// OBJECT
		//		console.log(&#x27;OBJECT: &#x27; + argMatch[3]);

				res.push({
					type: &#x27;object&#x27;,
					value: parseObjectStr(argMatch[3])
				});
			}
		}

		return res;
	};
});


/*

scope.partial(fn, [&#x27;key&#x27;, &#x27;key1&#x27;])

*/

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
