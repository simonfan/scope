//     scope
//     (c) simonfan
//     scope is licensed under the MIT terms.

define("__scope/iteration",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.each=function(){var e,t,i;if(n.isFunction(arguments[0])){t=arguments[0],i=arguments[1];for(var a in this)t.call(i,this[a],a)}else if(e=arguments[0],t=arguments[1],i=arguments[2],n.isRegExp(e))for(var a in this)e.test(this[a])&&t.call(i,this[a],a);else n.isArray(e)&&n.each(e,function(e){t.call(i,this[e],e)});return this},t.eachOwn=function(){var e,t,i;return n.isFunction(arguments[0])?(t=arguments[0],i=arguments[1],n.each(this,t,i)):(e=arguments[0],t=arguments[1],i=arguments[2],n.isRegExp(e)?n.each(this,function(n,a){e.test(a)&&t.call(i,n,a)}):n.isArray(e)&&n.each(e,function(e){this.hasOwnProperty(e)&&t.call(i,this[e],e)},this)),this}}),define("__scope/evaluation/string/parse",["require","exports","module","lodash"],function(e,t,n){function i(e){for(var t,n={};t=a.exec(e);)t[1]?n[t[1]]={type:"evaluated",value:t[1]}:t[2]&&(t[3]?n[t[2]]={type:"literal",value:t[3]}:t[4]&&(n[t[2]]={type:"evaluated",value:t[4]}));return n}var a=(e("lodash"),/(?:\$(\w+)|(?:(\w+):\s*(?:(\w+)|\$(\w+))))\s*(?:,|$)/g),r=/\s*(?:(\w+)|\$(\w+)|\{\s*(.*?)\s*\})\s*(?:,|$)/g;n.exports=function(e){for(var t,n=[];t=r.exec(e);)t[1]?n.push({type:"literal",value:t[1]}):t[2]&&n.push({type:"evaluated",value:t[2]}),t[3]&&n.push({type:"object",value:i(t[3])});return n}}),define("__scope/evaluation/string/index",["require","exports","module","lodash","./parse"],function(e,t,n){function i(e,t,n){return"literal"===t.type?t.value:"evaluated"===t.type?e[t.value]:a(e,t.value,n)}function a(e,t,n){var a={};return s.each(t,function(t,r){a[r]=i(e,t,n)}),a}function r(e,t,n){var a=[];return s.each(t,function(t){a.push(i(e,t,n))},e),a}var s=e("lodash"),o=e("./parse");n.exports=function(e,t,n){return n.own?void 0:(t=o(t),r(e,t,n))}}),define("__scope/evaluation/index",["require","exports","module","lodash","./string/index"],function(e,t){function n(e,t,n){var i={};return n.own?s.each(t,function(t){i[t]=s.isString(t)&&e.hasOwnProperty(t)?e[t]:e.evaluateOwn(t,n)}):s.each(t,function(t){i[t]=s.isString(t)?e[t]:e.evaluate(t,n)}),i}function i(e,t,n){return n.own?s.map(t,function(t){return s.isString(t)&&e.hasOwnProperty(t)?e[t]:e.evaluateOwn(t,n)}):s.map(t,function(t){return s.isString(t)?e[t]:e.evaluate(t,n)})}function a(e,t,n){var i={};return n.own?e.eachOwn(function(e,n){t.test(n)&&(i[n]=e)}):e.each(function(e,n){t.test(n)&&(i[n]=e)}),i}function r(e,t,n){var i={};return n.own?s.each(t,function(t,n){e.hasOwnProperty(n)&&(i[n]=e[n])}):s.each(t,function(t,n){i[n]=e[n]}),s.defaults(i,t),i}var s=e("lodash"),o=e("./string/index");t.evaluate=function(e,t){return t=t||{},s.isArray(e)?t&&"object"===t.format?n(this,e,t):i(this,e,t):s.isRegExp(e)?a(this,e,t):s.isObject(e)?r(this,e,t):s.isString(e)?o(this,e,t):void 0}}),define("__scope/invocation",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.invoke=function(e,t){e=n.isFunction(e)?e:this[e];var i=this.evaluate(t);return i=n.isArray(i)?i:[i],e.apply(null,i.concat(Array.prototype.slice.call(arguments,2)))},t.partial=function(e,t){return n.partial(this.invoke,e,t)},t.fn=function(e,t,n){return 1===arguments.length?this[e]:(this[e]=this.partial(t,n),t)}}),define("scope",["require","exports","module","lodash","subject","./__scope/iteration","./__scope/evaluation/index","./__scope/invocation"],function(e,t,n){var i=e("lodash"),a=e("subject"),r={enumerable:!1},s={enumerable:!1,writable:!1},o=n.exports=a({initialize:function(e,t){a.assign(this,e,t)}},r);o.proto({create:function(e,t){var n=a.assign(i.create(this),e,t);return a.assign(n,{parentScope:this},r),n},assign:function(e,t){return i.isString(e)?this[e]=t:i.isObject(e)&&i.assign(this,e),this}},s),o.assignProto(e("./__scope/iteration"),s).assignProto(e("./__scope/evaluation/index"),s).assignProto(e("./__scope/invocation"),s)});