//     scope
//     (c) simonfan
//     scope is licensed under the MIT terms.

define("__scope/iteration",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.each=function(){var e,t,r;if(n.isFunction(arguments[0])){t=arguments[0],r=arguments[1];for(var a in this)t.call(r,this[a],a)}else if(e=arguments[0],t=arguments[1],r=arguments[2],n.isRegExp(e))for(var a in this)e.test(this[a])&&t.call(r,this[a],a);else n.isArray(e)&&n.each(e,function(e){t.call(r,this[e],e)});return this},t.eachOwn=function(){var e,t,r;return n.isFunction(arguments[0])?(t=arguments[0],r=arguments[1],n.each(this,t,r)):(e=arguments[0],t=arguments[1],r=arguments[2],n.isRegExp(e)?n.each(this,function(n,a){e.test(a)&&t.call(r,n,a)}):n.isArray(e)&&n.each(e,function(e){this.hasOwnProperty(e)&&t.call(r,this[e],e)},this)),this}}),define("__scope/evaluation/string/parse",["require","exports","module","lodash"],function(e,t,n){function r(e){var t={};return e[1]?(t.type="literal",t.value=e[1]):e[2]?(t.type="evaluated",t.value=e[2]):e[3]?(t.type="array",t.value=o(e[3])):e[4]&&(t.type="object",t.value=i(e[4])),t}function a(e){var t=e.match(f);return r(t)}function i(e){for(var t,n={},r=new RegExp(v,"g");t=r.exec(e);)t[1]?n[t[1]]={type:"evaluated",value:t[1]}:t[2]&&(n[t[2]]=a(t[3]));return n}function o(e){for(var t,n=[],a=new RegExp(g,"g");t=a.exec(e);)n.push(r(t));return n}var s=(e("lodash"),"\\s*"),u="([^$[{,]+)",c="\\$([^,]+)?",l="\\["+s+"(.*?)"+s+"\\](?!.*?\\])",h="\\{"+s+"(.*?)"+s+"\\}(?!.*?\\})",p=[s+"(?:",u,"|",c,"|",l,"|",h,")"+s].join(""),f=new RegExp(p),v=[s+"(?:",c+s+"(?:,|$)|","(?:",u,":"+s,"(.*?)"+s+"(?:,(?!.*?})|$)",")",")"].join(""),g=p+"(?:,|$)";n.exports=a}),define("__scope/evaluation/string/index",["require","exports","module","lodash","deep","./parse"],function(e,t,n){function r(e,t,n){var r;return"literal"===t.type?r=t.value:"evaluated"===t.type?r=u.get(e,t.value):"array"===t.type?r=i(e,t.value,n):"object"===t.type&&(r=a(e,t.value,n)),r}function a(e,t,n){var a={};return s.each(t,function(t,i){a[i]=r(e,t,n)}),a}function i(e,t,n){var a=[];return s.each(t,function(t){a.push(r(e,t,n))},e),a}function o(e,t,n){return"$this"===t?e:(t=c(t),r(e,t,n))}var s=e("lodash"),u=e("deep"),c=e("./parse");n.exports=o}),define("__scope/evaluation/array",["require","exports","module","lodash"],function(e,t,n){function r(e,t,n){var r={};return n.own?i.each(t,function(t){r[t]=i.isString(t)&&e.hasOwnProperty(t)?e[t]:e.evaluateOwn(t,n)}):i.each(t,function(t){r[t]=i.isString(t)?e[t]:e.evaluate(t,n)}),r}function a(e,t,n){return n.own?i.map(t,function(t){return i.isString(t)&&e.hasOwnProperty(t)?e[t]:e.evaluateOwn(t,n)}):i.map(t,function(t){return i.isString(t)?e[t]:e.evaluate(t,n)})}var i=e("lodash");n.exports=function(e,t,n){return n&&"object"===n.format?r(e,t,n):a(e,t,n)}}),define("__scope/evaluation/object",["require","exports","module","lodash"],function(e,t,n){var r=e("lodash");n.exports=function(e,t,n){var a={};return n.own?r.each(t,function(t,n){e.hasOwnProperty(n)&&(a[n]=e[n])}):r.each(t,function(t,n){a[n]=e[n]}),r.defaults(a,t),a}}),define("__scope/evaluation/regexp",["require","exports","module","lodash"],function(e,t,n){e("lodash");n.exports=function(e,t,n){var r={};return n.own?e.eachOwn(function(e,n){t.test(n)&&(r[n]=e)}):e.each(function(e,n){t.test(n)&&(r[n]=e)}),r}}),define("__scope/evaluation/index",["require","exports","module","lodash","./string/index","./array","./object","./regexp"],function(e,t){var n=e("lodash"),r=e("./string/index"),a=e("./array"),i=e("./object"),o=e("./regexp");t.evaluate=function(e,t){return t=t||{},n.isArray(e)?a(this,e,t):n.isRegExp(e)?o(this,e,t):n.isObject(e)?i(this,e,t):n.isString(e)?r(this,e,t):e}}),define("__scope/invocation",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.invoke=function(e,t){if(n.isString(e)&&(e=this[e],!n.isFunction(e)))throw new Error("scope invoke error: fn "+e+" not a function.");if(!n.isFunction(e))throw new TypeError("scope invoke error: "+e+" is not a function.");var r=this.evaluate(t);return r=n.isArray(r)?r:[r],e.apply(this,r.concat(Array.prototype.slice.call(arguments,2)))},t.partial=function(e,t){return t=t||[],n.partial(this.invoke,e,t)},t.fn=function(){return n.isObject(arguments[0])?n.each(arguments[0],function(e,t){this.fn(t,e.fn,e.args)},this):this[arguments[0]]=this.partial(arguments[1],arguments[2]),this}}),define("scope",["require","exports","module","lodash","subject","./__scope/iteration","./__scope/evaluation/index","./__scope/invocation"],function(e,t,n){var r=e("lodash"),a=e("subject"),i={enumerable:!1},o={enumerable:!1,writable:!1},s=n.exports=a({initialize:function(e,t){this.assign(e,t)}},i);s.proto({create:function(e,t){var n=a.assign(r.create(this),e,t);return a.assign(n,{parentScope:this},i),n},assign:function(){var e,t;return r.isString(arguments[0])?(e={}[arguments[0]]=arguments[1],t=arguments[2]):r.isObject(arguments[0])&&(e=arguments[0],t=arguments[1]),a.assign(this,e,t),this}},o),s.assignProto(e("./__scope/iteration"),o).assignProto(e("./__scope/evaluation/index"),i).assignProto(e("./__scope/invocation"),i)});