//     scope
//     (c) simonfan
//     scope is licensed under the MIT terms.

define("__scope/iteration",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.each=function(){var e,t,r;if(n.isFunction(arguments[0])){t=arguments[0],r=arguments[1];for(var a in this)t.call(r,this[a],a)}else if(e=arguments[0],t=arguments[1],r=arguments[2],n.isRegExp(e))for(var a in this)e.test(this[a])&&t.call(r,this[a],a);else n.isArray(e)&&n.each(e,function(e){t.call(r,this[e],e)});return this},t.eachOwn=function(){var e,t,r;return n.isFunction(arguments[0])?(t=arguments[0],r=arguments[1],n.each(this,t,r)):(e=arguments[0],t=arguments[1],r=arguments[2],n.isRegExp(e)?n.each(this,function(n,a){e.test(a)&&t.call(r,n,a)}):n.isArray(e)&&n.each(e,function(e){this.hasOwnProperty(e)&&t.call(r,this[e],e)},this)),this}}),define("__scope/evaluation/string/parse",["require","exports","module","lodash"],function(e,t,n){function r(e){var t={};return e[1]?(t.type="literal",t.value=e[1]):e[2]?(t.type="evaluated",t.value=e[2]):e[3]?(t.type="array",t.value=s(e[3])):e[4]&&(t.type="object",t.value=i(e[4])),t}function a(e){var t=e.match(f);return r(t)}function i(e){for(var t,n={},r=new RegExp(v,"g");t=r.exec(e);)t[1]?n[t[1]]={type:"evaluated",value:t[1]}:t[2]&&(n[t[2]]=a(t[3]));return n}function s(e){for(var t,n=[],a=new RegExp(g,"g");t=a.exec(e);)n.push(r(t));return n}var o=(e("lodash"),"\\s*"),u="([^$[{]+)",c="\\$(\\w+)",l="\\["+o+"(.*?)"+o+"\\](?!.*?\\])",h="\\{"+o+"(.*?)"+o+"\\}(?!.*?\\})",p=[o+"(?:",u,"|",c,"|",l,"|",h,")"+o].join(""),f=new RegExp(p),v=[o+"(?:",c+o+"(?:,|$)|","(?:",u,":"+o,"(.*?)"+o+"(?:,(?!.*?})|$)",")",")"].join(""),g=p+"(?:,|$)";n.exports=a}),define("__scope/evaluation/string/index",["require","exports","module","lodash","./parse"],function(e,t,n){function r(e,t,n){var r;return"literal"===t.type?r=t.value:"evaluated"===t.type?r=e[t.value]:"array"===t.type?r=i(e,t.value,n):"object"===t.type&&(r=a(e,t.value,n)),r}function a(e,t,n){var a={};return o.each(t,function(t,i){a[i]=r(e,t,n)}),a}function i(e,t,n){var a=[];return o.each(t,function(t){a.push(r(e,t,n))},e),a}function s(e,t,n){return t=u(t),r(e,t,n)}var o=e("lodash"),u=e("./parse");n.exports=s}),define("__scope/evaluation/index",["require","exports","module","lodash","./string/index"],function(e,t){function n(e,t,n){var r={};return n.own?s.each(t,function(t){r[t]=s.isString(t)&&e.hasOwnProperty(t)?e[t]:e.evaluateOwn(t,n)}):s.each(t,function(t){r[t]=s.isString(t)?e[t]:e.evaluate(t,n)}),r}function r(e,t,n){return n.own?s.map(t,function(t){return s.isString(t)&&e.hasOwnProperty(t)?e[t]:e.evaluateOwn(t,n)}):s.map(t,function(t){return s.isString(t)?e[t]:e.evaluate(t,n)})}function a(e,t,n){var r={};return n.own?e.eachOwn(function(e,n){t.test(n)&&(r[n]=e)}):e.each(function(e,n){t.test(n)&&(r[n]=e)}),r}function i(e,t,n){var r={};return n.own?s.each(t,function(t,n){e.hasOwnProperty(n)&&(r[n]=e[n])}):s.each(t,function(t,n){r[n]=e[n]}),s.defaults(r,t),r}var s=e("lodash"),o=e("./string/index");t.evaluate=function(e,t){return t=t||{},s.isArray(e)?t&&"object"===t.format?n(this,e,t):r(this,e,t):s.isRegExp(e)?a(this,e,t):s.isObject(e)?i(this,e,t):s.isString(e)?o(this,e,t):void 0}}),define("__scope/invocation",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.invoke=function(e,t){e=n.isFunction(e)?e:this[e];var r=this.evaluate(t);return r=n.isArray(r)?r:[r],e.apply(null,r.concat(Array.prototype.slice.call(arguments,2)))},t.partial=function(e,t){return n.partial(this.invoke,e,t)},t.fn=function(e,t,n){return 1===arguments.length?this[e]:(this[e]=this.partial(t,n),t)}}),define("scope",["require","exports","module","lodash","subject","./__scope/iteration","./__scope/evaluation/index","./__scope/invocation"],function(e,t,n){var r=e("lodash"),a=e("subject"),i={enumerable:!1},s={enumerable:!1,writable:!1},o=n.exports=a({initialize:function(e,t){this.assign(e,t)}},i);o.proto({create:function(e,t){var n=a.assign(r.create(this),e,t);return a.assign(n,{parentScope:this},i),n},assign:function(){var e,t;return r.isString(arguments[0])?(e={}[arguments[0]]=arguments[1],t=arguments[2]):r.isObject(arguments[0])&&(e=arguments[0],t=arguments[1]),a.assign(this,e,t),this}},s),o.assignProto(e("./__scope/iteration"),s).assignProto(e("./__scope/evaluation/index"),i).assignProto(e("./__scope/invocation"),i)});