//     scope
//     (c) simonfan
//     scope is licensed under the MIT terms.

define("__scope/iteration",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.each=function(){var e,t,i;if(n.isFunction(arguments[0])){t=arguments[0],i=arguments[1];for(var r in this)t.call(i,this[r],r)}else if(e=arguments[0],t=arguments[1],i=arguments[2],n.isRegExp(e))for(var r in this)e.test(this[r])&&t.call(i,this[r],r);else n.isArray(e)&&n.each(e,function(e){t.call(i,this[e],e)});return this},t.eachOwn=function(){var e,t,i;return n.isFunction(arguments[0])?(t=arguments[0],i=arguments[1],n.each(this,t,i)):(e=arguments[0],t=arguments[1],i=arguments[2],n.isRegExp(e)?n.each(this,function(n,r){e.test(r)&&t.call(i,n,r)}):n.isArray(e)&&n.each(e,function(e){this.hasOwnProperty(e)&&t.call(i,this[e],e)},this)),this}}),define("__scope/evaluation/string/parse",["require","exports","module","lodash"],function(e,t,n){function i(e){var t={};return e[1]?(t.type="literal",t.value=e[1]):e[2]?(t.type="evaluated",t.value=e[2]):e[3]?(t.type="array",t.value=s(e[3])):e[4]&&(t.type="object",t.value=a(e[4])),t}function r(e){var t=e.match(f);return i(t)}function a(e){for(var t,n={},i=new RegExp(v,"g");t=i.exec(e);)t[1]?n[t[1]]={type:"evaluated",value:t[1]}:t[2]&&(n[t[2]]=r(t[3]));return n}function s(e){for(var t,n=[],r=new RegExp(g,"g");t=r.exec(e);)n.push(i(t));return n}var o=(e("lodash"),"\\s*"),u="(\\w+)",c="\\$(\\w+)",l="\\["+o+"(.*?)"+o+"\\](?!.*?\\])",h="\\{"+o+"(.*?)"+o+"\\}(?!.*?\\})",p=[o+"(?:",u,"|",c,"|",l,"|",h,")"+o].join(""),f=new RegExp(p),v=[o+"(?:",c+o+"(?:,|$)|","(?:",u,":"+o,"(.*?)"+o+"(?:,(?!.*?})|$)",")",")"].join(""),g=p+"(?:,|$)";n.exports=r}),define("__scope/evaluation/string/index",["require","exports","module","lodash","./parse"],function(e,t,n){function i(e,t,n){var i;return"literal"===t.type?i=t.value:"evaluated"===t.type?i=e[t.value]:"array"===t.type?i=a(e,t.value,n):"object"===t.type&&(i=r(e,t.value,n)),i}function r(e,t,n){var r={};return o.each(t,function(t,a){r[a]=i(e,t,n)}),r}function a(e,t,n){var r=[];return o.each(t,function(t){r.push(i(e,t,n))},e),r}function s(e,t,n){return t=u(t),i(e,t,n)}var o=e("lodash"),u=e("./parse");n.exports=s}),define("__scope/evaluation/index",["require","exports","module","lodash","./string/index"],function(e,t){function n(e,t,n){var i={};return n.own?s.each(t,function(t){i[t]=s.isString(t)&&e.hasOwnProperty(t)?e[t]:e.evaluateOwn(t,n)}):s.each(t,function(t){i[t]=s.isString(t)?e[t]:e.evaluate(t,n)}),i}function i(e,t,n){return n.own?s.map(t,function(t){return s.isString(t)&&e.hasOwnProperty(t)?e[t]:e.evaluateOwn(t,n)}):s.map(t,function(t){return s.isString(t)?e[t]:e.evaluate(t,n)})}function r(e,t,n){var i={};return n.own?e.eachOwn(function(e,n){t.test(n)&&(i[n]=e)}):e.each(function(e,n){t.test(n)&&(i[n]=e)}),i}function a(e,t,n){var i={};return n.own?s.each(t,function(t,n){e.hasOwnProperty(n)&&(i[n]=e[n])}):s.each(t,function(t,n){i[n]=e[n]}),s.defaults(i,t),i}var s=e("lodash"),o=e("./string/index");t.evaluate=function(e,t){return t=t||{},s.isArray(e)?t&&"object"===t.format?n(this,e,t):i(this,e,t):s.isRegExp(e)?r(this,e,t):s.isObject(e)?a(this,e,t):s.isString(e)?o(this,e,t):void 0}}),define("__scope/invocation",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.invoke=function(e,t){e=n.isFunction(e)?e:this[e];var i=this.evaluate(t);return i=n.isArray(i)?i:[i],e.apply(null,i.concat(Array.prototype.slice.call(arguments,2)))},t.partial=function(e,t){return n.partial(this.invoke,e,t)},t.fn=function(e,t,n){return 1===arguments.length?this[e]:(this[e]=this.partial(t,n),t)}}),define("scope",["require","exports","module","lodash","subject","./__scope/iteration","./__scope/evaluation/index","./__scope/invocation"],function(e,t,n){var i=e("lodash"),r=e("subject"),a={enumerable:!1},s={enumerable:!1,writable:!1},o=n.exports=r({initialize:function(e,t){r.assign(this,e,t)}},a);o.proto({create:function(e,t){var n=r.assign(i.create(this),e,t);return r.assign(n,{parentScope:this},a),n},assign:function(e,t){return i.isString(e)?this[e]=t:i.isObject(e)&&i.assign(this,e),this}},s),o.assignProto(e("./__scope/iteration"),s).assignProto(e("./__scope/evaluation/index"),s).assignProto(e("./__scope/invocation"),s)});